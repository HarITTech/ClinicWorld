<div class="container py-4" *ngIf="profile">
  <div class="row g-4">
    <!-- LEFT COLUMN -->
    <div class="col-lg-4">
      <div class="card p-4 text-center">
        <img [src]="getImageUrl(profile.profilePhoto)" class="avatar rounded-circle mx-auto mb-3" alt="Profile"
          style="width: 120px; height: 120px; object-fit: cover;" />
        <h4 class="mb-1">{{ profile.name }}</h4>
        <p class="mb-2 text-muted">
          <i class="fa-solid fa-stethoscope fa-fw"></i> {{profile.specialization}}
        </p>
        <p class="mb-3">
          <i class="fa-solid fa-briefcase fa-fw"></i> {{ profile.experience }} Years Experience
        </p>
        <button class="btn btn-accent w-100" data-bs-toggle="modal" data-bs-target="#editProfileModal">
          <i class="fa-solid fa-pen-to-square"></i> Edit Profile
        </button>
      </div>
    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-lg-8">
      <div class="card p-4">
        <h5 class="mb-3 details-header d-flex justify-content-between">
          <span>
            <i class="fa-solid fa-id-card fa-fw"></i> Details
          </span>
          <button class="profile-link" data-bs-toggle="modal" data-bs-target="#changePasswordModal"
            (click)="changePass(doctorId)">
            <i class="fa-solid fa-key me-1"></i> Change Password
          </button>
        </h5>


        <ul class="list-unstyled mb-0">
          <li class="mb-2">
            <strong><i class="fa-solid fa-phone fa-fw"></i> Phone:</strong>
            <a [href]="'tel:' + profile.phone" class="text-decoration-none" style="color: var(--accent)"> {{
              profile.phone }}</a>
          </li>
          <li class="mb-2">
            <strong><i class="fa-solid fa-clock fa-fw"></i> Timings:</strong> {{ profile.startTime }} to {{
            profile.endTime }} &nbsp; | &nbsp; <strong><i class="fas fa-sliders"></i> Max Tokens Per Day:</strong>
            {{profile.maxTokensPerDay}}
          </li>
          <li class="mb-2">
            <strong><i class="fa-solid fa-calendar-check fa-fw"></i> Working Days: </strong>
            <span *ngFor="let day of profile.workingDays" class="badge bg-secondary me-1"> {{ day }}</span>
          </li>
          <li class="mb-2">
            <strong><i class="fa-solid fa-map-marker-alt fa-fw"></i> Address:</strong> {{ profile.clinicAddress.street
            }}, {{ profile.clinicAddress.city }} - {{ profile.clinicAddress.pinCode }}, {{ profile.clinicAddress.state
            }}, {{ profile.clinicAddress.country }}
          </li>
          <li class="mb-3">
            <strong><i class="fa-solid fa-link fa-fw"></i> Map:</strong>
            <a href="{{profile.clinicLocationURL}}" target="_blank" class="text-decoration-none"
              style="color: var(--accent)"> Open
              in Google Maps</a>
          </li>
          <li>
            <strong><i class="fa-solid fa-info-circle fa-fw"></i> Bio:</strong> {{ profile.bio }}
          </li>
          <li class="profile-links" *ngIf="licenseCertificateUrl || degreeCertificateUrl">

            <a class="profile-link" *ngIf="licenseCertificateUrl" [href]="licenseCertificateUrl"
              [download]="'License-Certificate.pdf'">
              <i class="fa-regular fa-file-lines"></i> Download License Certificate
            </a>

            <a class="profile-link" *ngIf="degreeCertificateUrl" [href]="degreeCertificateUrl"
              [download]="'Degree-Certificate.pdf'">
              <i class="fa-solid fa-file-lines"></i> Download Degree Certificate
            </a>

          </li>

        </ul>
      </div>
    </div>
  </div>

  <!-- CLINIC & ACHIEVEMENT PHOTOS -->
  <div class="row mt-4 g-4">
    <div class="col-md-6">
      <div class="card p-3 photo-card">
        <h6><i class="fa-solid fa-image"></i> Clinic Photos</h6>
        <div class="d-flex gap-2 mt-2 flex-wrap">
          <img *ngFor="let photo of profile.clinicPhotos" [src]="getImageUrl(photo)"
            class="rounded img-fluid gallery-img" style="height: 90px; object-fit: cover;" />
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3 photo-card">
        <h6><i class="fa-solid fa-award"></i> Achievements</h6>
        <div class="d-flex gap-2 mt-2 flex-wrap">
          <img *ngFor="let ach of profile.achievements" [src]="getImageUrl(ach)" class="rounded img-fluid gallery-img"
            style="height: 90px; object-fit: cover;" />
        </div>
      </div>
    </div>
  </div>

  <!-- GRAPH SECTION -->
  <div class="row mt-4 g-4">
    <div class="col-lg-8">
      <div class="card p-3 photo-card">
        <h6><i class="fa-solid fa-chart-line"></i> Analytics & Graphs</h6>
        <div style="display: block;">
          <canvas baseChart [data]="barChartData" [type]="barChartType">
          </canvas>
        </div>
      </div>
    </div>
    <div class="col-lg-4 col-md-6">
      <div class="card p-3 photo-card mb-3">
        <h6><i class="fa-solid fa-chart-pie"></i> Last 30 Days Appointments</h6>
        <div style="display: block;">
          <canvas baseChart [data]="pieChartData" [type]="pieChartType">
          </canvas>
        </div>
      </div>
    </div>
  </div>
</div>




<!-- Edit Profile Modal -->
<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content clinic-modal-content">
      <form (ngSubmit)="submitForm()">
        <div class="modal-header clinic-modal-header">
          <h5 class="modal-title" id="editProfileModalLabel">
            <i class="fa-solid fa-pen-to-square"></i> Edit Doctor Profile
          </h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Input fields -->
          <div class="row g-3">
            <div class="col-sm-6 mb-2">
              <label>Name</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.name" name="name" required />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Phone</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.phone" name="phone" required />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Experience (Years)</label>
              <input type="number" class="form-control" [(ngModel)]="editForm.experience" name="experience" />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address Street</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.street" name="street" />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address City</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.city" name="city" />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address State</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.state" name="state" />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address Pincode</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.pinCode" name="pinCode" />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address Country</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.country" name="country" readonly />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Start Time</label>
              <input type="time" class="form-control" [(ngModel)]="editForm.startTime" name="startTime" required />
            </div>
            <div class="col-sm-6 mb-2">
              <label>End Time</label>
              <input type="time" class="form-control" [(ngModel)]="editForm.endTime" name="endTime" required />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Max Token Per Day</label>
              <input type="number" class="form-control" [(ngModel)]="editForm.maxTokensPerDay" name="maxTokensPerDay"
                required />
            </div>
            <div class="col-sm-6 mb-2">
              <label>Clinic Address URL</label>
              <input type="text" class="form-control" [(ngModel)]="editForm.clinicLocationURL" name="clinicLocationURL"
                required />
            </div>
            <div class="col-sm-12 mb-2">
              <label>Working Days (Comma Separated)</label>
              <input type="text" class="form-control" [ngModel]="editForm.workingDays.join(', ')"
                (ngModelChange)="onWorkingDaysChange($event)" name="workingDays" />
            </div>
            <div class="col-12 mb-2">
              <label>Bio</label>
              <textarea class="form-control" [(ngModel)]="editForm.bio" name="bio"></textarea>
            </div>
            <!-- File Uploads -->
            <div class="col-md-6 mb-2">
              <label>Profile Photo</label>
              <input type="file" class="form-control" (change)="onFileChange($event, 'profilePhoto')" />
            </div>
            <div class="col-md-6 mb-2">
              <label>License Certificate</label>
              <input type="file" class="form-control" (change)="onFileChange($event, 'licenseCertificate')" />
            </div>
            <div class="col-md-6 mb-2">
              <label>Degree Certificate</label>
              <input type="file" class="form-control" (change)="onFileChange($event, 'degreeCertificate')" />
            </div>
            <div class="col-md-6 mb-2">
              <label>Clinic Photos</label>
              <input type="file" class="form-control" multiple (change)="onFileChange($event, 'clinicPhotos')" />
            </div>
            <div class="col-md-6 mb-2">
              <label>Achievements</label>
              <input type="file" class="form-control" multiple (change)="onFileChange($event, 'achievements')" />
            </div>
          </div>
        </div>
        <div class="modal-footer clinic-modal-footer">
          <button type="button" class="btn btn-modal-outline" data-bs-dismiss="modal">
            Cancel
          </button>
          <button type="submit" class="btn btn-modal-accent" [disabled]="loading">
            <span *ngIf="!loading">Save Changes</span>
            <div *ngIf="loading" class="loader"></div>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- Change password MOdal -->
<div class="modal fade show" tabindex="-1" style="display: block;" *ngIf="showPasswordModal">
  <div class="modal-dialog">
    <div class="modal-content shadow change-password-modal">
      <div class="modal-header">
        <h5 class="modal-title">Change Password</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3 position-relative">
          <label>Old Password</label>
          <input [type]="showOldPassword ? 'text' : 'password'" class="form-control" [(ngModel)]="oldPassword" />
          <i class="fa-solid password-eye" [ngClass]="showOldPassword ? 'fa-eye-slash' : 'fa-eye'"
            (click)="togglePassword('old')"></i>
        </div>
        <div class="mb-3 position-relative">
          <label>New Password</label>
          <input [type]="showNewPassword ? 'text' : 'password'" class="form-control" [(ngModel)]="newPassword" />
          <i class="fa-solid password-eye" [ngClass]="showNewPassword ? 'fa-eye-slash' : 'fa-eye'"
            (click)="togglePassword('new')"></i>
        </div>
        <div class="mb-3 position-relative">
          <label>Confirm Password</label>
          <input [type]="showConfirmPassword ? 'text' : 'password'" class="form-control"
            [(ngModel)]="confirmPassword" />
          <i class="fa-solid password-eye" [ngClass]="showConfirmPassword ? 'fa-eye-slash' : 'fa-eye'"
            (click)="togglePassword('confirm')"></i>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline-light btn-cancel" (click)="closeModal()">Cancel</button>
        <button class="btn btn-info btn-change change-pass" (click)="change()" [disabled]="loading">
          <span *ngIf="!loading">Change</span>
          <div *ngIf="loading" class="loader"></div>
        </button>
      </div>
    </div>
  </div>
</div>
